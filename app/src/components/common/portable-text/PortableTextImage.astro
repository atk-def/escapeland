---
import type { SanityAsset } from '@sanity/image-url/lib/types/types'
import { urlForImage } from '~/sanity/image-builder'
import { Picture } from 'astro:assets'
import { getImageDimensions } from '@sanity/asset-utils'
import type { HTMLAttributes } from 'astro/types'

interface Props extends HTMLAttributes<'picture'> {
  node: {
    asset: SanityAsset
    alt?: string | null
  }
}

const { node, ...rest } = Astro.props
const { asset, alt } = node
const webpUrl = urlForImage(asset).format('webp').url()
const dimensions = getImageDimensions(webpUrl)
---

<Picture
  src={webpUrl}
  width={dimensions.width}
  height={dimensions.height}
  formats={['webp', 'avif', 'png', 'jpeg', 'jpg', 'svg']}
  draggable={false}
  alt={alt ?? '[picture]'}
  pictureAttributes={rest}
/>
