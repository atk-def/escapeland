---
import DefaultLayout from '~/components/DefaultLayout.astro'
import { PostItem } from '~/components/PostItem'
import { postsQuery } from '~/sanity/schemas/post'
import { runQuery } from '~/sanity/run-query'
import PortableTextImage from '~/components/PortableTextImage.astro'

const posts = await runQuery(postsQuery)
---

<DefaultLayout title={'BLOG'}>
  {
    posts && (
      <ul class="grid xl:grid-cols-4 lg:grid-cols-3 sm:grid-cols-2 gap-8">
        {posts
          .sort(
            (a, b) =>
              new Date(b.publishedAt).getTime() -
              new Date(a.publishedAt).getTime(),
          )
          .map((post) => {
            return (
              <li>
                <PostItem
                  client:load
                  preview={{
                    title: post.title,
                    slug: post.slug,
                    categories: post.categories,
                    publishedAt: post.publishedAt,
                  }}
                >
                  <PortableTextImage
                    class={'w-full h-40 object-cover'}
                    node={{ asset: post.mainImage.asset }}
                  />
                </PostItem>
              </li>
            )
          })}
      </ul>
    )
  }
</DefaultLayout>
