---
import DefaultLayout from '~/components/common/DefaultLayout.astro'
import { postsQuery } from '~/sanity/schemas/post'
import { runQuery } from '~/sanity/run-query'
import PortableTextImage from '~/components/common/portable-text/PortableTextImage.astro'
import { PostCard } from '~/components/common/PostCard'

const posts = await runQuery(postsQuery)
---

<DefaultLayout title={'BLOG'}>
  {
    posts && (
      <ul class="grid xl:grid-cols-4 lg:grid-cols-3 sm:grid-cols-2 gap-8">
        {posts
          .sort(
            (a, b) =>
              new Date(b.publishedAt).getTime() -
              new Date(a.publishedAt).getTime(),
          )
          .map((post) => {
            const { title, slug, categories, publishedAt } = post
            return (
              <li>
                <PostCard
                  preview={{
                    title,
                    slug,
                    categories,
                    publishedAt,
                  }}
                >
                  <PortableTextImage
                    class={'w-full h-40 object-cover'}
                    node={{ asset: post.mainImage.asset }}
                  />
                </PostCard>
              </li>
            )
          })}
      </ul>
    )
  }
</DefaultLayout>
