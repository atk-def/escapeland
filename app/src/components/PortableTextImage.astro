---
import type { SanityAsset } from '@sanity/image-url/lib/types/types'
import type { HTMLAttributes } from 'astro/types'
import { urlForImage } from '~/sanity/image-builder'

interface Props extends HTMLAttributes<'img'> {
  node: {
    asset: SanityAsset
    alt?: string | null
  }
}

const { node, class: className, ...rest } = Astro.props
const { asset, alt } = node
const url = urlForImage(asset).url()
const webpUrl = urlForImage(asset).format('webp').url()
---

<picture>
  <source srcset={webpUrl} type="image/webp" />
  <img class:list={['my-4', className]} src={url} alt={alt} {...rest} />
</picture>
