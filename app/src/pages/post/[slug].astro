---
import { runQuery } from '~/sanity/run-query'
import PortableText from '~/components/common/portable-text/PortableText.astro'
import DefaultLayout from '~/components/common/DefaultLayout.astro'
import { postsQuery, postDirectoryQuery } from '~/sanity/schemas/post'
import { Categories } from '~/components/common/Categories'
import type { Post } from '~/sanity/schemas/post'
import Directory from '~/components/common/Directory'

export async function getStaticPaths() {
  const posts = await runQuery(postsQuery)
  return posts.map((post) => {
    return {
      params: {
        slug: post.slug || '',
      },
      props: { ...post },
    }
  })
}

interface Props extends Post {}

const { publishedAt, categories, title, body } = Astro.props

const directory = await runQuery(postDirectoryQuery)
---

<DefaultLayout title={`${title} | BLOG`}>
  <div class="grid grid-cols-1 sm:grid-cols-[3fr,1fr] gap-4 h-full">
    <div>
      <Categories categories={categories} />
      <span class="text-sm">{publishedAt}</span>
      <h1 class="text-2xl font-bold mb-4">{title}</h1>
      <!-- @ts-ignore -->
      <PortableText value={body} />
    </div>
    <Directory
      client:load
      directory={directory}
      currentSlug={Astro.params.slug!}
    />
  </div>
</DefaultLayout>
