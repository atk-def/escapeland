---
import type { SanityAsset } from '@sanity/image-url/lib/types/types'
import { urlForImage } from '~/sanity/image-builder'
import { Picture } from 'astro:assets'
import { getImageDimensions } from '@sanity/asset-utils'

interface Props {
  asset: SanityAsset
  width?: number
  height?: number
  alt?: string | null
  class?: string | undefined | null
}

const { asset, width, height, alt, class: className, ...rest } = Astro.props
const webpUrl = urlForImage(asset).auto('format').url()
const dimensions = getImageDimensions(webpUrl)
---

<Picture
  data-cursor="-media"
  src={webpUrl}
  width={width ?? dimensions.width}
  height={height ?? dimensions.height}
  formats={['webp', 'avif', 'png', 'jpeg', 'svg']}
  draggable={false}
  alt={alt ?? '[picture]'}
  pictureAttributes={{ class: className }}
  {...rest}
/>
