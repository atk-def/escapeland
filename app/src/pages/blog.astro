---
import PageLayout from '~/layouts/PageLayout.astro'
import { postsQuery } from '~/sanity/schemas/post'
import { runQuery } from '~/sanity/run-query'
import PortableTextImage from '~/components/common/portable-text/PortableTextImage.astro'
import WithArticle from '~/components/common/WithArticle.astro'
import Categories from '~/components/common/Categories.astro'
import { sortDescendingByDate } from '~/utils/sort'

const posts = await runQuery(postsQuery)
---

<PageLayout title={'BLOG'}>
  {
    posts && (
      <ul class="grid xl:grid-cols-4 lg:grid-cols-3 sm:grid-cols-2 gap-8 pb-12">
        {posts.sort(sortDescendingByDate('publishedAt')).map((post) => {
          const { slug, categories, ...article } = post
          return (
            <li>
              <a href={`/post/${slug}`}>
                <WithArticle article={article}>
                  <PortableTextImage
                    class="mb-2"
                    node={{ asset: post.mainImage.asset }}
                  />
                  <Categories categories={categories} />
                </WithArticle>
              </a>
            </li>
          )
        })}
      </ul>
    )
  }
</PageLayout>
